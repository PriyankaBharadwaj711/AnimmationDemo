{"ast":null,"code":"\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar core_1 = require(\"@angular/core\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar vg_states_1 = require(\"../states/vg-states\");\n\nvar vg_api_1 = require(\"../services/vg-api\");\n\nvar vg_events_1 = require(\"../events/vg-events\");\n\nvar rxjs_2 = require(\"rxjs\");\n\nvar VgMedia =\n/** @class */\nfunction () {\n  function VgMedia(api, ref) {\n    this.api = api;\n    this.ref = ref;\n    this.state = vg_states_1.VgStates.VG_PAUSED;\n    this.time = {\n      current: 0,\n      total: 0,\n      left: 0\n    };\n    this.buffer = {\n      end: 0\n    };\n    this.canPlay = false;\n    this.canPlayThrough = false;\n    this.isMetadataLoaded = false;\n    this.isWaiting = false;\n    this.isCompleted = false;\n    this.isLive = false;\n    this.isBufferDetected = false;\n    this.checkInterval = 200;\n    this.currentPlayPos = 0;\n    this.lastPlayPos = 0;\n    this.playAtferSync = false;\n    this.bufferDetected = new rxjs_1.Subject();\n  }\n\n  VgMedia.prototype.ngOnInit = function () {\n    var _this = this;\n\n    if (this.vgMedia.nodeName) {\n      // It's a native element\n      this.elem = this.vgMedia;\n    } else {\n      // It's an Angular Class\n      this.elem = this.vgMedia.elem;\n    } // Just in case we're creating this vgMedia dynamically register again into API\n\n\n    this.api.registerMedia(this);\n    this.subscriptions = {\n      // Native events\n      abort: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ABORT),\n      canPlay: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_CAN_PLAY),\n      canPlayThrough: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_CAN_PLAY_THROUGH),\n      durationChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_DURATION_CHANGE),\n      emptied: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_EMPTIED),\n      encrypted: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ENCRYPTED),\n      ended: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ENDED),\n      error: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ERROR),\n      loadedData: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOADED_DATA),\n      loadedMetadata: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOADED_METADATA),\n      loadStart: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOAD_START),\n      pause: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PAUSE),\n      play: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PLAY),\n      playing: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PLAYING),\n      progress: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PROGRESS),\n      rateChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_RATE_CHANGE),\n      seeked: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SEEKED),\n      seeking: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SEEKING),\n      stalled: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_STALLED),\n      suspend: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SUSPEND),\n      timeUpdate: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_TIME_UPDATE),\n      volumeChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_VOLUME_CHANGE),\n      waiting: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_WAITING),\n      // Advertisement only events\n      startAds: rxjs_1.fromEvent(window, vg_events_1.VgEvents.VG_START_ADS),\n      endAds: rxjs_1.fromEvent(window, vg_events_1.VgEvents.VG_END_ADS),\n      // See changes on <source> child elements to reload the video file\n      mutation: rxjs_1.Observable.create(function (observer) {\n        var domObs = new MutationObserver(function (mutations) {\n          observer.next(mutations);\n        });\n        domObs.observe(_this.elem, {\n          childList: true,\n          attributes: true\n        });\n        return function () {\n          domObs.disconnect();\n        };\n      }),\n      // Custom buffering detection\n      bufferDetected: this.bufferDetected\n    };\n    this.mutationObs = this.subscriptions.mutation.subscribe(this.onMutation.bind(this));\n    this.canPlayObs = this.subscriptions.canPlay.subscribe(this.onCanPlay.bind(this));\n    this.canPlayThroughObs = this.subscriptions.canPlayThrough.subscribe(this.onCanPlayThrough.bind(this));\n    this.loadedMetadataObs = this.subscriptions.loadedMetadata.subscribe(this.onLoadMetadata.bind(this));\n    this.waitingObs = this.subscriptions.waiting.subscribe(this.onWait.bind(this));\n    this.progressObs = this.subscriptions.progress.subscribe(this.onProgress.bind(this));\n    this.endedObs = this.subscriptions.ended.subscribe(this.onComplete.bind(this));\n    this.playingObs = this.subscriptions.playing.subscribe(this.onStartPlaying.bind(this));\n    this.playObs = this.subscriptions.play.subscribe(this.onPlay.bind(this));\n    this.pauseObs = this.subscriptions.pause.subscribe(this.onPause.bind(this));\n    this.timeUpdateObs = this.subscriptions.timeUpdate.subscribe(this.onTimeUpdate.bind(this));\n    this.volumeChangeObs = this.subscriptions.volumeChange.subscribe(this.onVolumeChange.bind(this));\n    this.errorObs = this.subscriptions.error.subscribe(this.onError.bind(this));\n\n    if (this.vgMaster) {\n      this.api.playerReadyEvent.subscribe(function () {\n        _this.prepareSync();\n      });\n    }\n  };\n\n  VgMedia.prototype.prepareSync = function () {\n    var _this = this;\n\n    var canPlayAll = [];\n\n    for (var media in this.api.medias) {\n      if (this.api.medias[media]) {\n        canPlayAll.push(this.api.medias[media].subscriptions.canPlay);\n      }\n    }\n\n    this.canPlayAllSubscription = rxjs_2.combineLatest(canPlayAll).pipe(operators_1.map(function () {\n      var params = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        params[_i] = arguments[_i];\n      }\n\n      var checkReadyState = function (event) {\n        return event.target.readyState === 4;\n      };\n\n      var allReady = params.some(checkReadyState);\n\n      if (allReady && !_this.syncSubscription) {\n        _this.startSync();\n\n        _this.syncSubscription.unsubscribe();\n      }\n    })).subscribe();\n  };\n\n  VgMedia.prototype.startSync = function () {\n    var _this = this;\n\n    this.syncSubscription = rxjs_2.timer(0, 1000).subscribe(function () {\n      for (var media in _this.api.medias) {\n        if (_this.api.medias[media] !== _this) {\n          var diff = _this.api.medias[media].currentTime - _this.currentTime;\n\n          if (diff < -0.3 || diff > 0.3) {\n            _this.playAtferSync = _this.state === vg_states_1.VgStates.VG_PLAYING;\n\n            _this.pause();\n\n            _this.api.medias[media].pause();\n\n            _this.api.medias[media].currentTime = _this.currentTime;\n          } else {\n            if (_this.playAtferSync) {\n              _this.play();\n\n              _this.api.medias[media].play();\n\n              _this.playAtferSync = false;\n            }\n          }\n        }\n      }\n    });\n  };\n\n  VgMedia.prototype.onMutation = function (mutations) {\n    // Detect changes only for source elements or src attribute\n    for (var i = 0, l = mutations.length; i < l; i++) {\n      var mut = mutations[i];\n\n      if (mut.type === 'attributes' && mut.attributeName === 'src') {\n        // Only load src file if it's not a blob (for DASH / HLS sources)\n        if (mut.target['src'] && mut.target['src'].length > 0 && mut.target['src'].indexOf('blob:') < 0) {\n          this.loadMedia();\n          break;\n        }\n      } else if (mut.type === 'childList' && mut.removedNodes.length && mut.removedNodes[0].nodeName.toLowerCase() === 'source') {\n        this.loadMedia();\n        break;\n      }\n    }\n  };\n\n  VgMedia.prototype.loadMedia = function () {\n    var _this = this;\n\n    this.vgMedia.pause();\n    this.vgMedia.currentTime = 0; // Start buffering until we can play the media file\n\n    this.stopBufferCheck();\n    this.isBufferDetected = true;\n    this.bufferDetected.next(this.isBufferDetected); // TODO: This is ugly, we should find something cleaner. For some reason a TimerObservable doesn't works.\n\n    setTimeout(function () {\n      return _this.vgMedia.load();\n    }, 10);\n  };\n\n  VgMedia.prototype.play = function () {\n    var _this = this; // short-circuit if already playing\n\n\n    if (this.playPromise || this.state !== vg_states_1.VgStates.VG_PAUSED && this.state !== vg_states_1.VgStates.VG_ENDED) {\n      return;\n    }\n\n    this.playPromise = this.vgMedia.play(); // browser has async play promise\n\n    if (this.playPromise && this.playPromise.then && this.playPromise.catch) {\n      this.playPromise.then(function () {\n        _this.playPromise = null;\n      }).catch(function () {\n        _this.playPromise = null; // deliberately empty for the sake of eating console noise\n      });\n    }\n\n    return this.playPromise;\n  };\n\n  VgMedia.prototype.pause = function () {\n    var _this = this; // browser has async play promise\n\n\n    if (this.playPromise) {\n      this.playPromise.then(function () {\n        _this.vgMedia.pause();\n      });\n    } else {\n      this.vgMedia.pause();\n    }\n  };\n\n  Object.defineProperty(VgMedia.prototype, \"id\", {\n    get: function () {\n      // We should return undefined if vgMedia still doesn't exist\n      var result = undefined;\n\n      if (this.vgMedia) {\n        result = this.vgMedia.id;\n      }\n\n      return result;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"duration\", {\n    get: function () {\n      return this.vgMedia.duration;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"currentTime\", {\n    get: function () {\n      return this.vgMedia.currentTime;\n    },\n    set: function (seconds) {\n      this.vgMedia.currentTime = seconds; // this.elem.dispatchEvent(new CustomEvent(VgEvents.VG_SEEK));\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"volume\", {\n    get: function () {\n      return this.vgMedia.volume;\n    },\n    set: function (volume) {\n      this.vgMedia.volume = volume;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"playbackRate\", {\n    get: function () {\n      return this.vgMedia.playbackRate;\n    },\n    set: function (rate) {\n      this.vgMedia.playbackRate = rate;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"buffered\", {\n    get: function () {\n      return this.vgMedia.buffered;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(VgMedia.prototype, \"textTracks\", {\n    get: function () {\n      return this.vgMedia.textTracks;\n    },\n    enumerable: true,\n    configurable: true\n  }); // @ts-ignore\n\n  VgMedia.prototype.onCanPlay = function (event) {\n    this.isBufferDetected = false;\n    this.bufferDetected.next(this.isBufferDetected);\n    this.canPlay = true;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onCanPlayThrough = function (event) {\n    this.isBufferDetected = false;\n    this.bufferDetected.next(this.isBufferDetected);\n    this.canPlayThrough = true;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onLoadMetadata = function (event) {\n    this.isMetadataLoaded = true;\n    this.time = {\n      current: 0,\n      left: 0,\n      total: this.duration * 1000\n    };\n    this.state = vg_states_1.VgStates.VG_PAUSED; // Live streaming check\n\n    var t = Math.round(this.time.total);\n    this.isLive = t === Infinity;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onWait = function (event) {\n    this.isWaiting = true;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onComplete = function (event) {\n    this.isCompleted = true;\n    this.state = vg_states_1.VgStates.VG_ENDED;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onStartPlaying = function (event) {\n    this.state = vg_states_1.VgStates.VG_PLAYING;\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onPlay = function (event) {\n    this.state = vg_states_1.VgStates.VG_PLAYING;\n\n    if (this.vgMaster) {\n      if (!this.syncSubscription || this.syncSubscription.closed) {\n        this.startSync();\n      }\n    }\n\n    this.startBufferCheck();\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onPause = function (event) {\n    this.state = vg_states_1.VgStates.VG_PAUSED;\n\n    if (this.vgMaster) {\n      if (!this.playAtferSync) {\n        this.syncSubscription.unsubscribe();\n      }\n    }\n\n    this.stopBufferCheck();\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onTimeUpdate = function (event) {\n    var end = this.buffered.length - 1;\n    this.time = {\n      current: this.currentTime * 1000,\n      total: this.time.total,\n      left: (this.duration - this.currentTime) * 1000\n    };\n\n    if (end >= 0) {\n      this.buffer = {\n        end: this.buffered.end(end) * 1000\n      };\n    }\n\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onProgress = function (event) {\n    var end = this.buffered.length - 1;\n\n    if (end >= 0) {\n      this.buffer = {\n        end: this.buffered.end(end) * 1000\n      };\n    }\n\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onVolumeChange = function (event) {\n    // TODO: Save to localstorage the current volume\n    this.ref.detectChanges();\n  }; // @ts-ignore\n\n\n  VgMedia.prototype.onError = function (event) {\n    // TODO: Handle error messages\n    this.ref.detectChanges();\n  }; // http://stackoverflow.com/a/23828241/779529\n\n\n  VgMedia.prototype.bufferCheck = function () {\n    var offset = 1 / this.checkInterval;\n    this.currentPlayPos = this.currentTime;\n\n    if (!this.isBufferDetected && this.currentPlayPos < this.lastPlayPos + offset) {\n      this.isBufferDetected = true;\n    }\n\n    if (this.isBufferDetected && this.currentPlayPos > this.lastPlayPos + offset) {\n      this.isBufferDetected = false;\n    } // Prevent calls to bufferCheck after ngOnDestroy have been called\n\n\n    if (!this.bufferDetected.closed) {\n      this.bufferDetected.next(this.isBufferDetected);\n    }\n\n    this.lastPlayPos = this.currentPlayPos;\n  };\n\n  VgMedia.prototype.startBufferCheck = function () {\n    var _this = this;\n\n    this.checkBufferSubscription = rxjs_2.timer(0, this.checkInterval).subscribe(function () {\n      _this.bufferCheck();\n    });\n  };\n\n  VgMedia.prototype.stopBufferCheck = function () {\n    if (this.checkBufferSubscription) {\n      this.checkBufferSubscription.unsubscribe();\n    }\n\n    this.isBufferDetected = false;\n    this.bufferDetected.next(this.isBufferDetected);\n  };\n\n  VgMedia.prototype.seekTime = function (value, byPercent) {\n    if (byPercent === void 0) {\n      byPercent = false;\n    }\n\n    var second;\n    var duration = this.duration;\n\n    if (byPercent) {\n      second = value * duration / 100;\n    } else {\n      second = value;\n    }\n\n    this.currentTime = second;\n  };\n\n  VgMedia.prototype.addTextTrack = function (type, label, language, mode) {\n    var newTrack = this.vgMedia.addTextTrack(type, label, language);\n\n    if (mode) {\n      newTrack.mode = mode;\n    }\n\n    return newTrack;\n  };\n\n  VgMedia.prototype.ngOnDestroy = function () {\n    this.vgMedia.src = '';\n    this.mutationObs.unsubscribe();\n    this.canPlayObs.unsubscribe();\n    this.canPlayThroughObs.unsubscribe();\n    this.loadedMetadataObs.unsubscribe();\n    this.waitingObs.unsubscribe();\n    this.progressObs.unsubscribe();\n    this.endedObs.unsubscribe();\n    this.playingObs.unsubscribe();\n    this.playObs.unsubscribe();\n    this.pauseObs.unsubscribe();\n    this.timeUpdateObs.unsubscribe();\n    this.volumeChangeObs.unsubscribe();\n    this.errorObs.unsubscribe();\n\n    if (this.checkBufferSubscription) {\n      this.checkBufferSubscription.unsubscribe();\n    }\n\n    if (this.syncSubscription) {\n      this.syncSubscription.unsubscribe();\n    }\n\n    this.bufferDetected.complete();\n    this.bufferDetected.unsubscribe();\n    this.api.unregisterMedia(this);\n  };\n\n  __decorate([core_1.Input(), __metadata(\"design:type\", Object)], VgMedia.prototype, \"vgMedia\", void 0);\n\n  __decorate([core_1.Input(), __metadata(\"design:type\", Boolean)], VgMedia.prototype, \"vgMaster\", void 0);\n\n  VgMedia = __decorate([core_1.Directive({\n    selector: '[vgMedia]'\n  }), __metadata(\"design:paramtypes\", [vg_api_1.VgAPI, core_1.ChangeDetectorRef])], VgMedia);\n  return VgMedia;\n}();\n\nexports.VgMedia = VgMedia;","map":{"version":3,"sources":["/Users/priyanka/Desktop/ODU_Projects/anim/node_modules/videogular2/compiled/src/core/vg-media/vg-media.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","exports","value","core_1","require","rxjs_1","operators_1","vg_states_1","vg_api_1","vg_events_1","rxjs_2","VgMedia","api","ref","state","VgStates","VG_PAUSED","time","current","total","left","buffer","end","canPlay","canPlayThrough","isMetadataLoaded","isWaiting","isCompleted","isLive","isBufferDetected","checkInterval","currentPlayPos","lastPlayPos","playAtferSync","bufferDetected","Subject","prototype","ngOnInit","_this","vgMedia","nodeName","elem","registerMedia","subscriptions","abort","fromEvent","VgEvents","VG_ABORT","VG_CAN_PLAY","VG_CAN_PLAY_THROUGH","durationChange","VG_DURATION_CHANGE","emptied","VG_EMPTIED","encrypted","VG_ENCRYPTED","ended","VG_ENDED","error","VG_ERROR","loadedData","VG_LOADED_DATA","loadedMetadata","VG_LOADED_METADATA","loadStart","VG_LOAD_START","pause","VG_PAUSE","play","VG_PLAY","playing","VG_PLAYING","progress","VG_PROGRESS","rateChange","VG_RATE_CHANGE","seeked","VG_SEEKED","seeking","VG_SEEKING","stalled","VG_STALLED","suspend","VG_SUSPEND","timeUpdate","VG_TIME_UPDATE","volumeChange","VG_VOLUME_CHANGE","waiting","VG_WAITING","startAds","window","VG_START_ADS","endAds","VG_END_ADS","mutation","Observable","create","observer","domObs","MutationObserver","mutations","next","observe","childList","attributes","disconnect","mutationObs","subscribe","onMutation","bind","canPlayObs","onCanPlay","canPlayThroughObs","onCanPlayThrough","loadedMetadataObs","onLoadMetadata","waitingObs","onWait","progressObs","onProgress","endedObs","onComplete","playingObs","onStartPlaying","playObs","onPlay","pauseObs","onPause","timeUpdateObs","onTimeUpdate","volumeChangeObs","onVolumeChange","errorObs","onError","vgMaster","playerReadyEvent","prepareSync","canPlayAll","media","medias","push","canPlayAllSubscription","combineLatest","pipe","map","params","_i","checkReadyState","event","readyState","allReady","some","syncSubscription","startSync","unsubscribe","timer","diff","currentTime","l","mut","type","attributeName","indexOf","loadMedia","removedNodes","toLowerCase","stopBufferCheck","setTimeout","load","playPromise","then","catch","get","result","undefined","id","enumerable","configurable","duration","set","seconds","volume","playbackRate","rate","buffered","textTracks","detectChanges","t","Math","round","Infinity","closed","startBufferCheck","bufferCheck","offset","checkBufferSubscription","seekTime","byPercent","second","addTextTrack","label","language","mode","newTrack","ngOnDestroy","src","complete","unregisterMedia","Input","Boolean","Directive","selector","VgAPI","ChangeDetectorRef"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar core_1 = require(\"@angular/core\");\nvar rxjs_1 = require(\"rxjs\");\nvar operators_1 = require(\"rxjs/operators\");\nvar vg_states_1 = require(\"../states/vg-states\");\nvar vg_api_1 = require(\"../services/vg-api\");\nvar vg_events_1 = require(\"../events/vg-events\");\nvar rxjs_2 = require(\"rxjs\");\nvar VgMedia = /** @class */ (function () {\n    function VgMedia(api, ref) {\n        this.api = api;\n        this.ref = ref;\n        this.state = vg_states_1.VgStates.VG_PAUSED;\n        this.time = { current: 0, total: 0, left: 0 };\n        this.buffer = { end: 0 };\n        this.canPlay = false;\n        this.canPlayThrough = false;\n        this.isMetadataLoaded = false;\n        this.isWaiting = false;\n        this.isCompleted = false;\n        this.isLive = false;\n        this.isBufferDetected = false;\n        this.checkInterval = 200;\n        this.currentPlayPos = 0;\n        this.lastPlayPos = 0;\n        this.playAtferSync = false;\n        this.bufferDetected = new rxjs_1.Subject();\n    }\n    VgMedia.prototype.ngOnInit = function () {\n        var _this = this;\n        if (this.vgMedia.nodeName) {\n            // It's a native element\n            this.elem = this.vgMedia;\n        }\n        else {\n            // It's an Angular Class\n            this.elem = this.vgMedia.elem;\n        }\n        // Just in case we're creating this vgMedia dynamically register again into API\n        this.api.registerMedia(this);\n        this.subscriptions = {\n            // Native events\n            abort: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ABORT),\n            canPlay: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_CAN_PLAY),\n            canPlayThrough: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_CAN_PLAY_THROUGH),\n            durationChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_DURATION_CHANGE),\n            emptied: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_EMPTIED),\n            encrypted: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ENCRYPTED),\n            ended: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ENDED),\n            error: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_ERROR),\n            loadedData: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOADED_DATA),\n            loadedMetadata: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOADED_METADATA),\n            loadStart: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_LOAD_START),\n            pause: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PAUSE),\n            play: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PLAY),\n            playing: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PLAYING),\n            progress: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_PROGRESS),\n            rateChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_RATE_CHANGE),\n            seeked: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SEEKED),\n            seeking: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SEEKING),\n            stalled: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_STALLED),\n            suspend: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_SUSPEND),\n            timeUpdate: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_TIME_UPDATE),\n            volumeChange: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_VOLUME_CHANGE),\n            waiting: rxjs_1.fromEvent(this.elem, vg_events_1.VgEvents.VG_WAITING),\n            // Advertisement only events\n            startAds: rxjs_1.fromEvent(window, vg_events_1.VgEvents.VG_START_ADS),\n            endAds: rxjs_1.fromEvent(window, vg_events_1.VgEvents.VG_END_ADS),\n            // See changes on <source> child elements to reload the video file\n            mutation: rxjs_1.Observable.create(function (observer) {\n                var domObs = new MutationObserver(function (mutations) {\n                    observer.next(mutations);\n                });\n                domObs.observe(_this.elem, { childList: true, attributes: true });\n                return function () {\n                    domObs.disconnect();\n                };\n            }),\n            // Custom buffering detection\n            bufferDetected: this.bufferDetected\n        };\n        this.mutationObs = this.subscriptions.mutation.subscribe(this.onMutation.bind(this));\n        this.canPlayObs = this.subscriptions.canPlay.subscribe(this.onCanPlay.bind(this));\n        this.canPlayThroughObs = this.subscriptions.canPlayThrough.subscribe(this.onCanPlayThrough.bind(this));\n        this.loadedMetadataObs = this.subscriptions.loadedMetadata.subscribe(this.onLoadMetadata.bind(this));\n        this.waitingObs = this.subscriptions.waiting.subscribe(this.onWait.bind(this));\n        this.progressObs = this.subscriptions.progress.subscribe(this.onProgress.bind(this));\n        this.endedObs = this.subscriptions.ended.subscribe(this.onComplete.bind(this));\n        this.playingObs = this.subscriptions.playing.subscribe(this.onStartPlaying.bind(this));\n        this.playObs = this.subscriptions.play.subscribe(this.onPlay.bind(this));\n        this.pauseObs = this.subscriptions.pause.subscribe(this.onPause.bind(this));\n        this.timeUpdateObs = this.subscriptions.timeUpdate.subscribe(this.onTimeUpdate.bind(this));\n        this.volumeChangeObs = this.subscriptions.volumeChange.subscribe(this.onVolumeChange.bind(this));\n        this.errorObs = this.subscriptions.error.subscribe(this.onError.bind(this));\n        if (this.vgMaster) {\n            this.api.playerReadyEvent.subscribe(function () {\n                _this.prepareSync();\n            });\n        }\n    };\n    VgMedia.prototype.prepareSync = function () {\n        var _this = this;\n        var canPlayAll = [];\n        for (var media in this.api.medias) {\n            if (this.api.medias[media]) {\n                canPlayAll.push(this.api.medias[media].subscriptions.canPlay);\n            }\n        }\n        this.canPlayAllSubscription = rxjs_2.combineLatest(canPlayAll).pipe(operators_1.map(function () {\n            var params = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                params[_i] = arguments[_i];\n            }\n            var checkReadyState = function (event) {\n                return event.target.readyState === 4;\n            };\n            var allReady = params.some(checkReadyState);\n            if (allReady && !_this.syncSubscription) {\n                _this.startSync();\n                _this.syncSubscription.unsubscribe();\n            }\n        })).subscribe();\n    };\n    VgMedia.prototype.startSync = function () {\n        var _this = this;\n        this.syncSubscription = rxjs_2.timer(0, 1000).subscribe(function () {\n            for (var media in _this.api.medias) {\n                if (_this.api.medias[media] !== _this) {\n                    var diff = _this.api.medias[media].currentTime - _this.currentTime;\n                    if (diff < -0.3 || diff > 0.3) {\n                        _this.playAtferSync = (_this.state === vg_states_1.VgStates.VG_PLAYING);\n                        _this.pause();\n                        _this.api.medias[media].pause();\n                        _this.api.medias[media].currentTime = _this.currentTime;\n                    }\n                    else {\n                        if (_this.playAtferSync) {\n                            _this.play();\n                            _this.api.medias[media].play();\n                            _this.playAtferSync = false;\n                        }\n                    }\n                }\n            }\n        });\n    };\n    VgMedia.prototype.onMutation = function (mutations) {\n        // Detect changes only for source elements or src attribute\n        for (var i = 0, l = mutations.length; i < l; i++) {\n            var mut = mutations[i];\n            if (mut.type === 'attributes' && mut.attributeName === 'src') {\n                // Only load src file if it's not a blob (for DASH / HLS sources)\n                if (mut.target['src'] && mut.target['src'].length > 0 && mut.target['src'].indexOf('blob:') < 0) {\n                    this.loadMedia();\n                    break;\n                }\n            }\n            else if (mut.type === 'childList' && mut.removedNodes.length && mut.removedNodes[0].nodeName.toLowerCase() === 'source') {\n                this.loadMedia();\n                break;\n            }\n        }\n    };\n    VgMedia.prototype.loadMedia = function () {\n        var _this = this;\n        this.vgMedia.pause();\n        this.vgMedia.currentTime = 0;\n        // Start buffering until we can play the media file\n        this.stopBufferCheck();\n        this.isBufferDetected = true;\n        this.bufferDetected.next(this.isBufferDetected);\n        // TODO: This is ugly, we should find something cleaner. For some reason a TimerObservable doesn't works.\n        setTimeout(function () { return _this.vgMedia.load(); }, 10);\n    };\n    VgMedia.prototype.play = function () {\n        var _this = this;\n        // short-circuit if already playing\n        if (this.playPromise || (this.state !== vg_states_1.VgStates.VG_PAUSED && this.state !== vg_states_1.VgStates.VG_ENDED)) {\n            return;\n        }\n        this.playPromise = this.vgMedia.play();\n        // browser has async play promise\n        if (this.playPromise && this.playPromise.then && this.playPromise.catch) {\n            this.playPromise\n                .then(function () {\n                _this.playPromise = null;\n            })\n                .catch(function () {\n                _this.playPromise = null;\n                // deliberately empty for the sake of eating console noise\n            });\n        }\n        return this.playPromise;\n    };\n    VgMedia.prototype.pause = function () {\n        var _this = this;\n        // browser has async play promise\n        if (this.playPromise) {\n            this.playPromise\n                .then(function () {\n                _this.vgMedia.pause();\n            });\n        }\n        else {\n            this.vgMedia.pause();\n        }\n    };\n    Object.defineProperty(VgMedia.prototype, \"id\", {\n        get: function () {\n            // We should return undefined if vgMedia still doesn't exist\n            var result = undefined;\n            if (this.vgMedia) {\n                result = this.vgMedia.id;\n            }\n            return result;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"duration\", {\n        get: function () {\n            return this.vgMedia.duration;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"currentTime\", {\n        get: function () {\n            return this.vgMedia.currentTime;\n        },\n        set: function (seconds) {\n            this.vgMedia.currentTime = seconds;\n            // this.elem.dispatchEvent(new CustomEvent(VgEvents.VG_SEEK));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"volume\", {\n        get: function () {\n            return this.vgMedia.volume;\n        },\n        set: function (volume) {\n            this.vgMedia.volume = volume;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"playbackRate\", {\n        get: function () {\n            return this.vgMedia.playbackRate;\n        },\n        set: function (rate) {\n            this.vgMedia.playbackRate = rate;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"buffered\", {\n        get: function () {\n            return this.vgMedia.buffered;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(VgMedia.prototype, \"textTracks\", {\n        get: function () {\n            return this.vgMedia.textTracks;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // @ts-ignore\n    VgMedia.prototype.onCanPlay = function (event) {\n        this.isBufferDetected = false;\n        this.bufferDetected.next(this.isBufferDetected);\n        this.canPlay = true;\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onCanPlayThrough = function (event) {\n        this.isBufferDetected = false;\n        this.bufferDetected.next(this.isBufferDetected);\n        this.canPlayThrough = true;\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onLoadMetadata = function (event) {\n        this.isMetadataLoaded = true;\n        this.time = {\n            current: 0,\n            left: 0,\n            total: this.duration * 1000\n        };\n        this.state = vg_states_1.VgStates.VG_PAUSED;\n        // Live streaming check\n        var t = Math.round(this.time.total);\n        this.isLive = (t === Infinity);\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onWait = function (event) {\n        this.isWaiting = true;\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onComplete = function (event) {\n        this.isCompleted = true;\n        this.state = vg_states_1.VgStates.VG_ENDED;\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onStartPlaying = function (event) {\n        this.state = vg_states_1.VgStates.VG_PLAYING;\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onPlay = function (event) {\n        this.state = vg_states_1.VgStates.VG_PLAYING;\n        if (this.vgMaster) {\n            if (!this.syncSubscription || this.syncSubscription.closed) {\n                this.startSync();\n            }\n        }\n        this.startBufferCheck();\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onPause = function (event) {\n        this.state = vg_states_1.VgStates.VG_PAUSED;\n        if (this.vgMaster) {\n            if (!this.playAtferSync) {\n                this.syncSubscription.unsubscribe();\n            }\n        }\n        this.stopBufferCheck();\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onTimeUpdate = function (event) {\n        var end = this.buffered.length - 1;\n        this.time = {\n            current: this.currentTime * 1000,\n            total: this.time.total,\n            left: (this.duration - this.currentTime) * 1000\n        };\n        if (end >= 0) {\n            this.buffer = { end: this.buffered.end(end) * 1000 };\n        }\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onProgress = function (event) {\n        var end = this.buffered.length - 1;\n        if (end >= 0) {\n            this.buffer = { end: this.buffered.end(end) * 1000 };\n        }\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onVolumeChange = function (event) {\n        // TODO: Save to localstorage the current volume\n        this.ref.detectChanges();\n    };\n    // @ts-ignore\n    VgMedia.prototype.onError = function (event) {\n        // TODO: Handle error messages\n        this.ref.detectChanges();\n    };\n    // http://stackoverflow.com/a/23828241/779529\n    VgMedia.prototype.bufferCheck = function () {\n        var offset = 1 / this.checkInterval;\n        this.currentPlayPos = this.currentTime;\n        if (!this.isBufferDetected && this.currentPlayPos < (this.lastPlayPos + offset)) {\n            this.isBufferDetected = true;\n        }\n        if (this.isBufferDetected && this.currentPlayPos > (this.lastPlayPos + offset)) {\n            this.isBufferDetected = false;\n        }\n        // Prevent calls to bufferCheck after ngOnDestroy have been called\n        if (!this.bufferDetected.closed) {\n            this.bufferDetected.next(this.isBufferDetected);\n        }\n        this.lastPlayPos = this.currentPlayPos;\n    };\n    VgMedia.prototype.startBufferCheck = function () {\n        var _this = this;\n        this.checkBufferSubscription = rxjs_2.timer(0, this.checkInterval).subscribe(function () {\n            _this.bufferCheck();\n        });\n    };\n    VgMedia.prototype.stopBufferCheck = function () {\n        if (this.checkBufferSubscription) {\n            this.checkBufferSubscription.unsubscribe();\n        }\n        this.isBufferDetected = false;\n        this.bufferDetected.next(this.isBufferDetected);\n    };\n    VgMedia.prototype.seekTime = function (value, byPercent) {\n        if (byPercent === void 0) { byPercent = false; }\n        var second;\n        var duration = this.duration;\n        if (byPercent) {\n            second = value * duration / 100;\n        }\n        else {\n            second = value;\n        }\n        this.currentTime = second;\n    };\n    VgMedia.prototype.addTextTrack = function (type, label, language, mode) {\n        var newTrack = this.vgMedia.addTextTrack(type, label, language);\n        if (mode) {\n            newTrack.mode = mode;\n        }\n        return newTrack;\n    };\n    VgMedia.prototype.ngOnDestroy = function () {\n        this.vgMedia.src = '';\n        this.mutationObs.unsubscribe();\n        this.canPlayObs.unsubscribe();\n        this.canPlayThroughObs.unsubscribe();\n        this.loadedMetadataObs.unsubscribe();\n        this.waitingObs.unsubscribe();\n        this.progressObs.unsubscribe();\n        this.endedObs.unsubscribe();\n        this.playingObs.unsubscribe();\n        this.playObs.unsubscribe();\n        this.pauseObs.unsubscribe();\n        this.timeUpdateObs.unsubscribe();\n        this.volumeChangeObs.unsubscribe();\n        this.errorObs.unsubscribe();\n        if (this.checkBufferSubscription) {\n            this.checkBufferSubscription.unsubscribe();\n        }\n        if (this.syncSubscription) {\n            this.syncSubscription.unsubscribe();\n        }\n        this.bufferDetected.complete();\n        this.bufferDetected.unsubscribe();\n        this.api.unregisterMedia(this);\n    };\n    __decorate([\n        core_1.Input(),\n        __metadata(\"design:type\", Object)\n    ], VgMedia.prototype, \"vgMedia\", void 0);\n    __decorate([\n        core_1.Input(),\n        __metadata(\"design:type\", Boolean)\n    ], VgMedia.prototype, \"vgMaster\", void 0);\n    VgMedia = __decorate([\n        core_1.Directive({\n            selector: '[vgMedia]'\n        }),\n        __metadata(\"design:paramtypes\", [vg_api_1.VgAPI, core_1.ChangeDetectorRef])\n    ], VgMedia);\n    return VgMedia;\n}());\nexports.VgMedia = VgMedia;\n"]},"metadata":{},"sourceType":"script"}