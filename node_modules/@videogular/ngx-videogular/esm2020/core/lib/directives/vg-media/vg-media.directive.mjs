import { Directive, Input, ChangeDetectorRef, } from '@angular/core';
import { Observable, Subject, fromEvent, timer, combineLatest, } from 'rxjs';
import { map } from 'rxjs/operators';
import { VgApiService } from '../../services/vg-api/vg-api.service';
import { VgStates } from '../../services/states/vg-states.service';
import { VgEvents } from '../../services/events/vg-events.service';
import * as i0 from "@angular/core";
import * as i1 from "../../services/vg-api/vg-api.service";
export class VgMediaDirective {
    constructor(api, ref) {
        this.api = api;
        this.ref = ref;
        this.state = VgStates.VG_PAUSED;
        this.time = { current: 0, total: 0, left: 0 };
        this.buffer = { end: 0 };
        this.canPlay = false;
        this.canPlayThrough = false;
        this.isMetadataLoaded = false;
        this.isWaiting = false;
        this.isCompleted = false;
        this.isLive = false;
        this.isBufferDetected = false;
        this.checkInterval = 200;
        this.currentPlayPos = 0;
        this.lastPlayPos = 0;
        this.playAtferSync = false;
        this.bufferDetected = new Subject();
    }
    ngOnInit() {
        if (this.vgMedia.nodeName) {
            // It's a native element
            this.elem = this.vgMedia;
        }
        else {
            // It's an Angular Class
            this.elem = this.vgMedia.elem;
        }
        // Just in case we're creating this vgMedia dynamically register again into API
        this.api.registerMedia(this);
        this.subscriptions = {
            // Native events
            abort: fromEvent(this.elem, VgEvents.VG_ABORT),
            canPlay: fromEvent(this.elem, VgEvents.VG_CAN_PLAY),
            canPlayThrough: fromEvent(this.elem, VgEvents.VG_CAN_PLAY_THROUGH),
            durationChange: fromEvent(this.elem, VgEvents.VG_DURATION_CHANGE),
            emptied: fromEvent(this.elem, VgEvents.VG_EMPTIED),
            encrypted: fromEvent(this.elem, VgEvents.VG_ENCRYPTED),
            ended: fromEvent(this.elem, VgEvents.VG_ENDED),
            error: fromEvent(this.elem, VgEvents.VG_ERROR),
            loadedData: fromEvent(this.elem, VgEvents.VG_LOADED_DATA),
            loadedMetadata: fromEvent(this.elem, VgEvents.VG_LOADED_METADATA),
            loadStart: fromEvent(this.elem, VgEvents.VG_LOAD_START),
            pause: fromEvent(this.elem, VgEvents.VG_PAUSE),
            play: fromEvent(this.elem, VgEvents.VG_PLAY),
            playing: fromEvent(this.elem, VgEvents.VG_PLAYING),
            progress: fromEvent(this.elem, VgEvents.VG_PROGRESS),
            rateChange: fromEvent(this.elem, VgEvents.VG_RATE_CHANGE),
            seeked: fromEvent(this.elem, VgEvents.VG_SEEKED),
            seeking: fromEvent(this.elem, VgEvents.VG_SEEKING),
            stalled: fromEvent(this.elem, VgEvents.VG_STALLED),
            suspend: fromEvent(this.elem, VgEvents.VG_SUSPEND),
            timeUpdate: fromEvent(this.elem, VgEvents.VG_TIME_UPDATE),
            volumeChange: fromEvent(this.elem, VgEvents.VG_VOLUME_CHANGE),
            waiting: fromEvent(this.elem, VgEvents.VG_WAITING),
            // Advertisement only events
            startAds: fromEvent(window, VgEvents.VG_START_ADS),
            endAds: fromEvent(window, VgEvents.VG_END_ADS),
            // See changes on <source> child elements to reload the video file
            mutation: new Observable((observer) => {
                const domObs = new MutationObserver((mutations) => {
                    observer.next(mutations);
                });
                domObs.observe(this.elem, { childList: true, attributes: true });
                return () => {
                    domObs.disconnect();
                };
            }),
            // Custom buffering detection
            bufferDetected: this.bufferDetected,
        };
        this.mutationObs = this.subscriptions.mutation.subscribe(this.onMutation.bind(this));
        this.canPlayObs = this.subscriptions.canPlay.subscribe(this.onCanPlay.bind(this));
        this.canPlayThroughObs = this.subscriptions.canPlayThrough.subscribe(this.onCanPlayThrough.bind(this));
        this.loadedMetadataObs = this.subscriptions.loadedMetadata.subscribe(this.onLoadMetadata.bind(this));
        this.waitingObs = this.subscriptions.waiting.subscribe(this.onWait.bind(this));
        this.progressObs = this.subscriptions.progress.subscribe(this.onProgress.bind(this));
        this.endedObs = this.subscriptions.ended.subscribe(this.onComplete.bind(this));
        this.playingObs = this.subscriptions.playing.subscribe(this.onStartPlaying.bind(this));
        this.playObs = this.subscriptions.play.subscribe(this.onPlay.bind(this));
        this.pauseObs = this.subscriptions.pause.subscribe(this.onPause.bind(this));
        this.timeUpdateObs = this.subscriptions.timeUpdate.subscribe(this.onTimeUpdate.bind(this));
        this.volumeChangeObs = this.subscriptions.volumeChange.subscribe(this.onVolumeChange.bind(this));
        this.errorObs = this.subscriptions.error.subscribe(this.onError.bind(this));
        if (this.vgMaster) {
            this.api.playerReadyEvent.subscribe(() => {
                this.prepareSync();
            });
        }
    }
    prepareSync() {
        const canPlayAll = [];
        for (const media in this.api.medias) {
            if (this.api.medias[media]) {
                canPlayAll.push(this.api.medias[media].subscriptions.canPlay);
            }
        }
        this.canPlayAllSubscription = combineLatest(canPlayAll)
            .pipe(map((...params) => {
            const checkReadyState = (event) => {
                if (!event?.target) {
                    return false;
                }
                return event.target.readyState === 4;
            };
            const allReady = params.some(checkReadyState);
            if (allReady && !this.syncSubscription) {
                this.startSync();
                this.syncSubscription.unsubscribe();
            }
        }))
            .subscribe();
    }
    startSync() {
        this.syncSubscription = timer(0, 1000).subscribe(() => {
            for (const media in this.api.medias) {
                if (this.api.medias[media] !== this) {
                    const diff = this.api.medias[media].currentTime - this.currentTime;
                    if (diff < -0.3 || diff > 0.3) {
                        this.playAtferSync = this.state === VgStates.VG_PLAYING;
                        this.pause();
                        this.api.medias[media].pause();
                        this.api.medias[media].currentTime = this.currentTime;
                    }
                    else {
                        if (this.playAtferSync) {
                            this.play();
                            this.api.medias[media].play();
                            this.playAtferSync = false;
                        }
                    }
                }
            }
        });
    }
    onMutation(mutations) {
        // Detect changes only for source elements or src attribute
        for (let i = 0, l = mutations.length; i < l; i++) {
            const mut = mutations[i];
            if (mut.type === 'attributes' && mut.attributeName === 'src') {
                // Only load src file if it's not a blob (for DASH / HLS sources)
                if (mut.target.src &&
                    mut.target.src.length > 0 &&
                    mut.target.src.indexOf('blob:') < 0) {
                    this.loadMedia();
                    break;
                }
            }
            else if (mut.type === 'childList' &&
                mut.removedNodes.length &&
                mut.removedNodes[0].nodeName.toLowerCase() === 'source') {
                this.loadMedia();
                break;
            }
        }
    }
    loadMedia() {
        this.vgMedia.pause();
        this.vgMedia.currentTime = 0;
        // Start buffering until we can play the media file
        this.stopBufferCheck();
        this.isBufferDetected = true;
        this.bufferDetected.next(this.isBufferDetected);
        // TODO: This is ugly, we should find something cleaner. For some reason a TimerObservable doesn't works.
        setTimeout(() => this.vgMedia.load(), 10);
    }
    play() {
        // short-circuit if already playing
        if (this.playPromise ||
            (this.state !== VgStates.VG_PAUSED && this.state !== VgStates.VG_ENDED)) {
            return;
        }
        this.playPromise = this.vgMedia.play();
        // browser has async play promise
        if (this.playPromise && this.playPromise.then && this.playPromise.catch) {
            this.playPromise
                .then(() => {
                this.playPromise = null;
            })
                .catch(() => {
                this.playPromise = null;
                // deliberately empty for the sake of eating console noise
            });
        }
        return this.playPromise;
    }
    pause() {
        // browser has async play promise
        if (this.playPromise) {
            this.playPromise.then(() => {
                this.vgMedia.pause();
            });
        }
        else {
            this.vgMedia.pause();
        }
    }
    get id() {
        // We should return undefined if vgMedia still doesn't exist
        let result;
        if (this.vgMedia) {
            result = this.vgMedia.id;
        }
        return result;
    }
    get duration() {
        return this.vgMedia.duration === Infinity
            ? this.specifiedDuration
            : this.vgMedia.duration;
    }
    set currentTime(seconds) {
        this.vgMedia.currentTime = seconds;
        // this.elem.dispatchEvent(new CustomEvent(VgEvents.VG_SEEK));
    }
    get currentTime() {
        return this.vgMedia.currentTime;
    }
    set volume(volume) {
        this.vgMedia.volume = volume;
    }
    get volume() {
        return this.vgMedia.volume;
    }
    set playbackRate(rate) {
        this.vgMedia.playbackRate = rate;
    }
    get playbackRate() {
        return this.vgMedia.playbackRate;
    }
    get buffered() {
        return this.vgMedia.buffered;
    }
    get textTracks() {
        return this.vgMedia.textTracks;
    }
    // @ts-ignore
    onCanPlay(event) {
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
        this.canPlay = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onCanPlayThrough(event) {
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
        this.canPlayThrough = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onLoadMetadata(event) {
        this.isMetadataLoaded = true;
        this.time = {
            current: 0,
            left: 0,
            total: this.duration * 1000,
        };
        this.state = VgStates.VG_PAUSED;
        // Live streaming check
        const t = Math.round(this.time.total);
        this.isLive = t === Infinity;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onWait(event) {
        this.isWaiting = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onComplete(event) {
        this.isCompleted = true;
        this.state = VgStates.VG_ENDED;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onStartPlaying(event) {
        this.state = VgStates.VG_PLAYING;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onPlay(event) {
        this.state = VgStates.VG_PLAYING;
        if (this.vgMaster) {
            if (!this.syncSubscription || this.syncSubscription.closed) {
                this.startSync();
            }
        }
        this.startBufferCheck();
        this.ref.detectChanges();
    }
    // @ts-ignore
    onPause(event) {
        this.state = VgStates.VG_PAUSED;
        if (this.vgMaster) {
            if (!this.playAtferSync) {
                this.syncSubscription.unsubscribe();
            }
        }
        this.stopBufferCheck();
        this.ref.detectChanges();
    }
    // @ts-ignore
    onTimeUpdate(event) {
        const end = this.buffered.length - 1;
        this.time = {
            current: this.currentTime * 1000,
            total: this.time.total,
            left: (this.duration - this.currentTime) * 1000,
        };
        if (end >= 0) {
            this.buffer = { end: this.buffered.end(end) * 1000 };
        }
        this.ref.detectChanges();
    }
    // @ts-ignore
    onProgress(event) {
        const end = this.buffered.length - 1;
        if (end >= 0) {
            this.buffer = { end: this.buffered.end(end) * 1000 };
        }
        this.ref.detectChanges();
    }
    // @ts-ignore
    onVolumeChange(event) {
        // TODO: Save to localstorage the current volume
        this.ref.detectChanges();
    }
    // @ts-ignore
    onError(event) {
        // TODO: Handle error messages
        this.ref.detectChanges();
    }
    // http://stackoverflow.com/a/23828241/779529
    bufferCheck() {
        const offset = 1 / this.checkInterval;
        this.currentPlayPos = this.currentTime;
        if (!this.isBufferDetected &&
            this.currentPlayPos < this.lastPlayPos + offset) {
            this.isBufferDetected = true;
        }
        if (this.isBufferDetected &&
            this.currentPlayPos > this.lastPlayPos + offset) {
            this.isBufferDetected = false;
        }
        // Prevent calls to bufferCheck after ngOnDestroy have been called
        if (!this.bufferDetected.closed) {
            this.bufferDetected.next(this.isBufferDetected);
        }
        this.lastPlayPos = this.currentPlayPos;
    }
    startBufferCheck() {
        this.checkBufferSubscription = timer(0, this.checkInterval).subscribe(() => {
            this.bufferCheck();
        });
    }
    stopBufferCheck() {
        if (this.checkBufferSubscription) {
            this.checkBufferSubscription.unsubscribe();
        }
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
    }
    seekTime(value, byPercent = false) {
        let second;
        const duration = this.duration;
        if (byPercent) {
            second = (value * duration) / 100;
        }
        else {
            second = value;
        }
        this.currentTime = second;
    }
    addTextTrack(type, label, language, mode) {
        const newTrack = this.vgMedia.addTextTrack(type, label, language);
        if (mode) {
            newTrack.mode = mode;
        }
        return newTrack;
    }
    ngOnDestroy() {
        this.vgMedia.src = '';
        this.mutationObs?.unsubscribe();
        this.canPlayObs?.unsubscribe();
        this.canPlayThroughObs?.unsubscribe();
        this.loadedMetadataObs?.unsubscribe();
        this.waitingObs?.unsubscribe();
        this.progressObs?.unsubscribe();
        this.endedObs?.unsubscribe();
        this.playingObs?.unsubscribe();
        this.playObs?.unsubscribe();
        this.pauseObs?.unsubscribe();
        this.timeUpdateObs?.unsubscribe();
        this.volumeChangeObs?.unsubscribe();
        this.errorObs?.unsubscribe();
        this.checkBufferSubscription?.unsubscribe();
        this.syncSubscription?.unsubscribe();
        this.bufferDetected?.complete();
        this.bufferDetected?.unsubscribe();
        this.api.unregisterMedia(this);
    }
}
/** @nocollapse */ /** @nocollapse */ VgMediaDirective.ɵfac = function VgMediaDirective_Factory(t) { return new (t || VgMediaDirective)(i0.ɵɵdirectiveInject(i1.VgApiService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef)); };
/** @nocollapse */ /** @nocollapse */ VgMediaDirective.ɵdir = /** @pureOrBreakMyCode */ i0.ɵɵdefineDirective({ type: VgMediaDirective, selectors: [["", "vgMedia", ""]], inputs: { vgMedia: "vgMedia", vgMaster: "vgMaster" } });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(VgMediaDirective, [{
        type: Directive,
        args: [{
                selector: '[vgMedia]',
            }]
    }], function () { return [{ type: i1.VgApiService }, { type: i0.ChangeDetectorRef }]; }, { vgMedia: [{
            type: Input
        }], vgMaster: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmctbWVkaWEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtdmlkZW9ndWxhci9jb3JlL3NyYy9saWIvZGlyZWN0aXZlcy92Zy1tZWRpYS92Zy1tZWRpYS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFHVCxLQUFLLEVBQ0wsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxVQUFVLEVBRVYsT0FBTyxFQUNQLFNBQVMsRUFDVCxLQUFLLEVBQ0wsYUFBYSxHQUNkLE1BQU0sTUFBTSxDQUFDO0FBQ2QsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTXJDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHlDQUF5QyxDQUFDOzs7QUFLbkUsTUFBTSxPQUFPLGdCQUFnQjtJQWtEM0IsWUFBb0IsR0FBaUIsRUFBVSxHQUFzQjtRQUFqRCxRQUFHLEdBQUgsR0FBRyxDQUFjO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUE1Q3JFLFVBQUssR0FBVyxRQUFRLENBQUMsU0FBUyxDQUFDO1FBRW5DLFNBQUksR0FBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDOUMsV0FBTSxHQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBSXpCLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFDaEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIs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Z0IsRUFBRSxXQUFXLEVBQUUsQ0FBQztRQUVyQyxJQUFJLENBQUMsY0FBYyxFQUFFLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxjQUFjLEVBQUUsV0FBVyxFQUFFLENBQUM7UUFFbkMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsQ0FBQzs7c0hBemhCVSxnQkFBZ0I7cUhBQWhCLGdCQUFnQjt1RkFBaEIsZ0JBQWdCO2NBSDVCLFNBQVM7ZUFBQztnQkFDVCxRQUFRLEVBQUUsV0FBVzthQUN0QjsrRkFJVSxPQUFPO2tCQUFmLEtBQUs7WUFDRyxRQUFRO2tCQUFoQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBPbkluaXQsXG4gIE9uRGVzdHJveSxcbiAgSW5wdXQsXG4gIENoYW5nZURldGVjdG9yUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIE9ic2VydmFibGUsXG4gIFN1YnNjcmlwdGlvbixcbiAgU3ViamVjdCxcbiAgZnJvbUV2ZW50LFxuICB0aW1lcixcbiAgY29tYmluZUxhdGVzdCxcbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBJUGxheWFibGUsXG4gIElNZWRpYVN1YnNjcmlwdGlvbnMsXG59IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvdmctbWVkaWEtYXBpLmludGVyZmFjZSc7XG5pbXBvcnQgeyBJTWVkaWFFbGVtZW50IH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9pLW1lZGlhLWVsZW1lbnQuaW50ZXJmYWNlJztcbmltcG9ydCB7IFZnQXBpU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3ZnLWFwaS92Zy1hcGkuc2VydmljZSc7XG5pbXBvcnQgeyBWZ1N0YXRlcyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXRlcy92Zy1zdGF0ZXMuc2VydmljZSc7XG5pbXBvcnQgeyBWZ0V2ZW50cyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2V2ZW50cy92Zy1ldmVudHMuc2VydmljZSc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1t2Z01lZGlhXScsXG59KVxuZXhwb3J0IGNsYXNzIFZnTWVkaWFEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgSVBsYXlhYmxlIHtcbiAgZWxlbTogYW55O1xuXG4gIEBJbnB1dCgpIHZnTWVkaWE6IElNZWRpYUVsZW1lbnQ7XG4gIEBJbnB1dCgpIHZnTWFzdGVyOiBib29sZWFuO1xuXG4gIHN0YXRlOiBzdHJpbmcgPSBWZ1N0YXRlcy5WR19QQVVTRUQ7XG5cbiAgdGltZTogYW55ID0geyBjdXJyZW50OiAwLCB0b3RhbDogMCwgbGVmdDogMCB9O1xuICBidWZmZXI6IGFueSA9IHsgZW5kOiAwIH07XG4gIHRyYWNrOiBhbnk7XG4gIHN1YnNjcmlwdGlvbnM6IElNZWRpYVN1YnNjcmlwdGlvbnMgfCBhbnk7XG5cbiAgY2FuUGxheSA9IGZhbHNlO1xuICBjYW5QbGF5VGhyb3VnaCA9IGZhbHNlO1xuICBpc01ldGFkYXRhTG9hZGVkID0gZmFsc2U7XG4gIGlzV2FpdGluZyA9IGZhbHNlO1xuICBpc0NvbXBsZXRlZCA9IGZhbHNlO1xuICBpc0xpdmUgPSBmYWxzZTtcblxuICBpc0J1ZmZlckRldGVjdGVkID0gZmFsc2U7XG5cbiAgY2hlY2tJbnRlcnZhbCA9IDIwMDtcbiAgY3VycmVudFBsYXlQb3MgPSAwO1xuICBsYXN0UGxheVBvcyA9IDA7XG4gIHNwZWNpZmllZER1cmF0aW9uOiBudW1iZXI7XG5cbiAgY2hlY2tCdWZmZXJTdWJzY3JpcHRpb246IGFueTtcbiAgc3luY1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBjYW5QbGF5QWxsU3Vic2NyaXB0aW9uOiBhbnk7XG4gIHBsYXlBdGZlclN5bmMgPSBmYWxzZTtcblxuICBtdXRhdGlvbk9iczogU3Vic2NyaXB0aW9uO1xuICBjYW5QbGF5T2JzOiBTdWJzY3JpcHRpb247XG4gIGNhblBsYXlUaHJvdWdoT2JzOiBTdWJzY3JpcHRpb247XG4gIGxvYWRlZE1ldGFkYXRhT2JzOiBTdWJzY3JpcHRpb247XG4gIHdhaXRpbmdPYnM6IFN1YnNjcmlwdGlvbjtcbiAgcHJvZ3Jlc3NPYnM6IFN1YnNjcmlwdGlvbjtcbiAgZW5kZWRPYnM6IFN1YnNjcmlwdGlvbjtcbiAgcGxheWluZ09iczogU3Vic2NyaXB0aW9uO1xuICBwbGF5T2JzOiBTdWJzY3JpcHRpb247XG4gIHBhdXNlT2JzOiBTdWJzY3JpcHRpb247XG4gIHRpbWVVcGRhdGVPYnM6IFN1YnNjcmlwdGlvbjtcbiAgdm9sdW1lQ2hhbmdlT2JzOiBTdWJzY3JpcHRpb247XG4gIGVycm9yT2JzOiBTdWJzY3JpcHRpb247XG5cbiAgYnVmZmVyRGV0ZWN0ZWQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHBsYXlQcm9taXNlOiBQcm9taXNlPGFueT47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGk6IFZnQXBpU2VydmljZSwgcHJpdmF0ZSByZWY6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLnZnTWVkaWEubm9kZU5hbWUpIHtcbiAgICAgIC8vIEl0J3MgYSBuYXRpdmUgZWxlbWVudFxuICAgICAgdGhpcy5lbGVtID0gdGhpcy52Z01lZGlhO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJdCdzIGFuIEFuZ3VsYXIgQ2xhc3NcbiAgICAgIHRoaXMuZWxlbSA9IHRoaXMudmdNZWRpYS5lbGVtO1xuICAgIH1cblxuICAgIC8vIEp1c3QgaW4gY2FzZSB3ZSdyZSBjcmVhdGluZyB0aGlzIHZnTWVkaWEgZHluYW1pY2FsbHkgcmVnaXN0ZXIgYWdhaW4gaW50byBBUElcbiAgICB0aGlzLmFwaS5yZWdpc3Rlck1lZGlhKHRoaXMpO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0ge1xuICAgICAgLy8gTmF0aXZlIGV2ZW50c1xuICAgICAgYWJvcnQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19BQk9SVCksXG4gICAgICBjYW5QbGF5OiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfQ0FOX1BMQVkpLFxuICAgICAgY2FuUGxheVRocm91Z2g6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19DQU5fUExBWV9USFJPVUdIKSxcbiAgICAgIGR1cmF0aW9uQ2hhbmdlOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfRFVSQVRJT05fQ0hBTkdFKSxcbiAgICAgIGVtcHRpZWQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19FTVBUSUVEKSxcbiAgICAgIGVuY3J5cHRlZDogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0VOQ1JZUFRFRCksXG4gICAgICBlbmRlZDogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0VOREVEKSxcbiAgICAgIGVycm9yOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfRVJST1IpLFxuICAgICAgbG9hZGVkRGF0YTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0xPQURFRF9EQVRBKSxcbiAgICAgIGxvYWRlZE1ldGFkYXRhOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfTE9BREVEX01FVEFEQVRBKSxcbiAgICAgIGxvYWRTdGFydDogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0xPQURfU1RBUlQpLFxuICAgICAgcGF1c2U6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19QQVVTRSksXG4gICAgICBwbGF5OiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfUExBWSksXG4gICAgICBwbGF5aW5nOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfUExBWUlORyksXG4gICAgICBwcm9ncmVzczogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1BST0dSRVNTKSxcbiAgICAgIHJhdGVDaGFuZ2U6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19SQVRFX0NIQU5HRSksXG4gICAgICBzZWVrZWQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19TRUVLRUQpLFxuICAgICAgc2Vla2luZzogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1NFRUtJTkcpLFxuICAgICAgc3RhbGxlZDogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1NUQUxMRUQpLFxuICAgICAgc3VzcGVuZDogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1NVU1BFTkQpLFxuICAgICAgdGltZVVwZGF0ZTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1RJTUVfVVBEQVRFKSxcbiAgICAgIHZvbHVtZUNoYW5nZTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1ZPTFVNRV9DSEFOR0UpLFxuICAgICAgd2FpdGluZzogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1dBSVRJTkcpLFxuXG4gICAgICAvLyBBZHZlcnRpc2VtZW50IG9ubHkgZXZlbnRzXG4gICAgICBzdGFydEFkczogZnJvbUV2ZW50KHdpbmRvdyBhcyBhbnksIFZnRXZlbnRzLlZHX1NUQVJUX0FEUyksXG4gICAgICBlbmRBZHM6IGZyb21FdmVudCh3aW5kb3cgYXMgYW55LCBWZ0V2ZW50cy5WR19FTkRfQURTKSxcblxuICAgICAgLy8gU2VlIGNoYW5nZXMgb24gPHNvdXJjZT4gY2hpbGQgZWxlbWVudHMgdG8gcmVsb2FkIHRoZSB2aWRlbyBmaWxlXG4gICAgICBtdXRhdGlvbjogbmV3IE9ic2VydmFibGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgZG9tT2JzID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQobXV0YXRpb25zKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9tT2JzLm9ic2VydmUodGhpcy5lbGVtIGFzIGFueSwgeyBjaGlsZExpc3Q6IHRydWUsIGF0dHJpYnV0ZXM6IHRydWUgfSk7XG5cbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICBkb21PYnMuZGlzY29ubmVjdCgpO1xuICAgICAgICB9O1xuICAgICAgfSksXG5cbiAgICAgIC8vIEN1c3RvbSBidWZmZXJpbmcgZGV0ZWN0aW9uXG4gICAgICBidWZmZXJEZXRlY3RlZDogdGhpcy5idWZmZXJEZXRlY3RlZCxcbiAgICB9O1xuXG4gICAgdGhpcy5tdXRhdGlvbk9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5tdXRhdGlvbi5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uTXV0YXRpb24uYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5jYW5QbGF5T2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLmNhblBsYXkuc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vbkNhblBsYXkuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5jYW5QbGF5VGhyb3VnaE9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5jYW5QbGF5VGhyb3VnaC5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uQ2FuUGxheVRocm91Z2guYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5sb2FkZWRNZXRhZGF0YU9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5sb2FkZWRNZXRhZGF0YS5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uTG9hZE1ldGFkYXRhLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMud2FpdGluZ09icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy53YWl0aW5nLnN1YnNjcmliZShcbiAgICAgIHRoaXMub25XYWl0LmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMucHJvZ3Jlc3NPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMucHJvZ3Jlc3Muc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vblByb2dyZXNzLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMuZW5kZWRPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMuZW5kZWQuc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vbkNvbXBsZXRlLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMucGxheWluZ09icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5wbGF5aW5nLnN1YnNjcmliZShcbiAgICAgIHRoaXMub25TdGFydFBsYXlpbmcuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5wbGF5T2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLnBsYXkuc3Vic2NyaWJlKHRoaXMub25QbGF5LmJpbmQodGhpcykpO1xuICAgIHRoaXMucGF1c2VPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMucGF1c2Uuc3Vic2NyaWJlKHRoaXMub25QYXVzZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnRpbWVVcGRhdGVPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMudGltZVVwZGF0ZS5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uVGltZVVwZGF0ZS5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLnZvbHVtZUNoYW5nZU9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy52b2x1bWVDaGFuZ2Uuc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vblZvbHVtZUNoYW5nZS5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLmVycm9yT2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLmVycm9yLnN1YnNjcmliZSh0aGlzLm9uRXJyb3IuYmluZCh0aGlzKSk7XG5cbiAgICBpZiAodGhpcy52Z01hc3Rlcikge1xuICAgICAgdGhpcy5hcGkucGxheWVyUmVhZHlFdmVudC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnByZXBhcmVTeW5jKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcmVwYXJlU3luYygpIHtcbiAgICBjb25zdCBjYW5QbGF5QWxsOiBPYnNlcnZhYmxlPGFueT5bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBtZWRpYSBpbiB0aGlzLmFwaS5tZWRpYXMpIHtcbiAgICAgIGlmICh0aGlzLmFwaS5tZWRpYXNbbWVkaWFdKSB7XG4gICAgICAgIGNhblBsYXlBbGwucHVzaCh0aGlzLmFwaS5tZWRpYXNbbWVkaWFdLnN1YnNjcmlwdGlvbnMuY2FuUGxheSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5jYW5QbGF5QWxsU3Vic2NyaXB0aW9uID0gY29tYmluZUxhdGVzdChjYW5QbGF5QWxsKVxuICAgICAgLnBpcGUobWFwKCguLi5wYXJhbXMpID0+IHtcbiAgICAgICAgY29uc3QgY2hlY2tSZWFkeVN0YXRlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgaWYgKCFldmVudD8udGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGV2ZW50LnRhcmdldC5yZWFkeVN0YXRlID09PSA0O1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGFsbFJlYWR5OiBib29sZWFuID0gcGFyYW1zLnNvbWUoY2hlY2tSZWFkeVN0YXRlKTtcblxuICAgICAgICBpZiAoYWxsUmVhZHkgJiYgIXRoaXMuc3luY1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgIHRoaXMuc3RhcnRTeW5jKCk7XG4gICAgICAgICAgdGhpcy5zeW5jU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgc3RhcnRTeW5jKCkge1xuICAgIHRoaXMuc3luY1N1YnNjcmlwdGlvbiA9IHRpbWVyKDAsIDEwMDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IG1lZGlhIGluIHRoaXMuYXBpLm1lZGlhcykge1xuICAgICAgICBpZiAodGhpcy5hcGkubWVkaWFzW21lZGlhXSAhPT0gdGhpcykge1xuICAgICAgICAgIGNvbnN0IGRpZmY6IG51bWJlciA9XG4gICAgICAgICAgICB0aGlzLmFwaS5tZWRpYXNbbWVkaWFdLmN1cnJlbnRUaW1lIC0gdGhpcy5jdXJyZW50VGltZTtcblxuICAgICAgICAgIGlmIChkaWZmIDwgLTAuMyB8fCBkaWZmID4gMC4zKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXlBdGZlclN5bmMgPSB0aGlzLnN0YXRlID09PSBWZ1N0YXRlcy5WR19QTEFZSU5HO1xuXG4gICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLmFwaS5tZWRpYXNbbWVkaWFdLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLmFwaS5tZWRpYXNbbWVkaWFdLmN1cnJlbnRUaW1lID0gdGhpcy5jdXJyZW50VGltZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMucGxheUF0ZmVyU3luYykge1xuICAgICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgICAgICAgdGhpcy5hcGkubWVkaWFzW21lZGlhXS5wbGF5KCk7XG4gICAgICAgICAgICAgIHRoaXMucGxheUF0ZmVyU3luYyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25NdXRhdGlvbihtdXRhdGlvbnM6IEFycmF5PE11dGF0aW9uUmVjb3JkPikge1xuICAgIC8vIERldGVjdCBjaGFuZ2VzIG9ubHkgZm9yIHNvdXJjZSBlbGVtZW50cyBvciBzcmMgYXR0cmlidXRlXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBtdXRhdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICBjb25zdCBtdXQ6IE11dGF0aW9uUmVjb3JkID0gbXV0YXRpb25zW2ldO1xuXG4gICAgICBpZiAobXV0LnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiBtdXQuYXR0cmlidXRlTmFtZSA9PT0gJ3NyYycpIHtcbiAgICAgICAgLy8gT25seSBsb2FkIHNyYyBmaWxlIGlmIGl0J3Mgbm90IGEgYmxvYiAoZm9yIERBU0ggLyBITFMgc291cmNlcylcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChtdXQudGFyZ2V0IGFzIGFueSkuc3JjICYmXG4gICAgICAgICAgKG11dC50YXJnZXQgYXMgYW55KS5zcmMubGVuZ3RoID4gMCAmJlxuICAgICAgICAgIChtdXQudGFyZ2V0IGFzIGFueSkuc3JjLmluZGV4T2YoJ2Jsb2I6JykgPCAwXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMubG9hZE1lZGlhKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIG11dC50eXBlID09PSAnY2hpbGRMaXN0JyAmJlxuICAgICAgICBtdXQucmVtb3ZlZE5vZGVzLmxlbmd0aCAmJlxuICAgICAgICBtdXQucmVtb3ZlZE5vZGVzWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzb3VyY2UnXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5sb2FkTWVkaWEoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbG9hZE1lZGlhKCkge1xuICAgIHRoaXMudmdNZWRpYS5wYXVzZSgpO1xuICAgIHRoaXMudmdNZWRpYS5jdXJyZW50VGltZSA9IDA7XG5cbiAgICAvLyBTdGFydCBidWZmZXJpbmcgdW50aWwgd2UgY2FuIHBsYXkgdGhlIG1lZGlhIGZpbGVcbiAgICB0aGlzLnN0b3BCdWZmZXJDaGVjaygpO1xuICAgIHRoaXMuaXNCdWZmZXJEZXRlY3RlZCA9IHRydWU7XG4gICAgdGhpcy5idWZmZXJEZXRlY3RlZC5uZXh0KHRoaXMuaXNCdWZmZXJEZXRlY3RlZCk7XG5cbiAgICAvLyBUT0RPOiBUaGlzIGlzIHVnbHksIHdlIHNob3VsZCBmaW5kIHNvbWV0aGluZyBjbGVhbmVyLiBGb3Igc29tZSByZWFzb24gYSBUaW1lck9ic2VydmFibGUgZG9lc24ndCB3b3Jrcy5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudmdNZWRpYS5sb2FkKCksIDEwKTtcbiAgfVxuXG4gIHBsYXkoKSB7XG4gICAgLy8gc2hvcnQtY2lyY3VpdCBpZiBhbHJlYWR5IHBsYXlpbmdcbiAgICBpZiAoXG4gICAgICB0aGlzLnBsYXlQcm9taXNlIHx8XG4gICAgICAodGhpcy5zdGF0ZSAhPT0gVmdTdGF0ZXMuVkdfUEFVU0VEICYmIHRoaXMuc3RhdGUgIT09IFZnU3RhdGVzLlZHX0VOREVEKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucGxheVByb21pc2UgPSB0aGlzLnZnTWVkaWEucGxheSgpO1xuXG4gICAgLy8gYnJvd3NlciBoYXMgYXN5bmMgcGxheSBwcm9taXNlXG4gICAgaWYgKHRoaXMucGxheVByb21pc2UgJiYgdGhpcy5wbGF5UHJvbWlzZS50aGVuICYmIHRoaXMucGxheVByb21pc2UuY2F0Y2gpIHtcbiAgICAgIHRoaXMucGxheVByb21pc2VcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMucGxheVByb21pc2UgPSBudWxsO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgIHRoaXMucGxheVByb21pc2UgPSBudWxsO1xuICAgICAgICAgIC8vIGRlbGliZXJhdGVseSBlbXB0eSBmb3IgdGhlIHNha2Ugb2YgZWF0aW5nIGNvbnNvbGUgbm9pc2VcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGxheVByb21pc2U7XG4gIH1cblxuICBwYXVzZSgpIHtcbiAgICAvLyBicm93c2VyIGhhcyBhc3luYyBwbGF5IHByb21pc2VcbiAgICBpZiAodGhpcy5wbGF5UHJvbWlzZSkge1xuICAgICAgdGhpcy5wbGF5UHJvbWlzZS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy52Z01lZGlhLnBhdXNlKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52Z01lZGlhLnBhdXNlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGlkKCkge1xuICAgIC8vIFdlIHNob3VsZCByZXR1cm4gdW5kZWZpbmVkIGlmIHZnTWVkaWEgc3RpbGwgZG9lc24ndCBleGlzdFxuICAgIGxldCByZXN1bHQ6IGFueTtcblxuICAgIGlmICh0aGlzLnZnTWVkaWEpIHtcbiAgICAgIHJlc3VsdCA9IHRoaXMudmdNZWRpYS5pZDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZ2V0IGR1cmF0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEuZHVyYXRpb24gPT09IEluZmluaXR5XG4gICAgICA/IHRoaXMuc3BlY2lmaWVkRHVyYXRpb25cbiAgICAgIDogdGhpcy52Z01lZGlhLmR1cmF0aW9uO1xuICB9XG5cbiAgc2V0IGN1cnJlbnRUaW1lKHNlY29uZHMpIHtcbiAgICB0aGlzLnZnTWVkaWEuY3VycmVudFRpbWUgPSBzZWNvbmRzO1xuICAgIC8vIHRoaXMuZWxlbS5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChWZ0V2ZW50cy5WR19TRUVLKSk7XG4gIH1cblxuICBnZXQgY3VycmVudFRpbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmdNZWRpYS5jdXJyZW50VGltZTtcbiAgfVxuXG4gIHNldCB2b2x1bWUodm9sdW1lKSB7XG4gICAgdGhpcy52Z01lZGlhLnZvbHVtZSA9IHZvbHVtZTtcbiAgfVxuXG4gIGdldCB2b2x1bWUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmdNZWRpYS52b2x1bWU7XG4gIH1cblxuICBzZXQgcGxheWJhY2tSYXRlKHJhdGUpIHtcbiAgICB0aGlzLnZnTWVkaWEucGxheWJhY2tSYXRlID0gcmF0ZTtcbiAgfVxuXG4gIGdldCBwbGF5YmFja1JhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmdNZWRpYS5wbGF5YmFja1JhdGU7XG4gIH1cblxuICBnZXQgYnVmZmVyZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMudmdNZWRpYS5idWZmZXJlZDtcbiAgfVxuXG4gIGdldCB0ZXh0VHJhY2tzKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEudGV4dFRyYWNrcztcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uQ2FuUGxheShldmVudDogYW55KSB7XG4gICAgdGhpcy5pc0J1ZmZlckRldGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5idWZmZXJEZXRlY3RlZC5uZXh0KHRoaXMuaXNCdWZmZXJEZXRlY3RlZCk7XG4gICAgdGhpcy5jYW5QbGF5ID0gdHJ1ZTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbkNhblBsYXlUaHJvdWdoKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmJ1ZmZlckRldGVjdGVkLm5leHQodGhpcy5pc0J1ZmZlckRldGVjdGVkKTtcbiAgICB0aGlzLmNhblBsYXlUaHJvdWdoID0gdHJ1ZTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbkxvYWRNZXRhZGF0YShldmVudDogYW55KSB7XG4gICAgdGhpcy5pc01ldGFkYXRhTG9hZGVkID0gdHJ1ZTtcblxuICAgIHRoaXMudGltZSA9IHtcbiAgICAgIGN1cnJlbnQ6IDAsXG4gICAgICBsZWZ0OiAwLFxuICAgICAgdG90YWw6IHRoaXMuZHVyYXRpb24gKiAxMDAwLFxuICAgIH07XG5cbiAgICB0aGlzLnN0YXRlID0gVmdTdGF0ZXMuVkdfUEFVU0VEO1xuXG4gICAgLy8gTGl2ZSBzdHJlYW1pbmcgY2hlY2tcbiAgICBjb25zdCB0OiBudW1iZXIgPSBNYXRoLnJvdW5kKHRoaXMudGltZS50b3RhbCk7XG4gICAgdGhpcy5pc0xpdmUgPSB0ID09PSBJbmZpbml0eTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbldhaXQoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaXNXYWl0aW5nID0gdHJ1ZTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbkNvbXBsZXRlKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLmlzQ29tcGxldGVkID0gdHJ1ZTtcbiAgICB0aGlzLnN0YXRlID0gVmdTdGF0ZXMuVkdfRU5ERUQ7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25TdGFydFBsYXlpbmcoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuc3RhdGUgPSBWZ1N0YXRlcy5WR19QTEFZSU5HO1xuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uUGxheShldmVudDogYW55KSB7XG4gICAgdGhpcy5zdGF0ZSA9IFZnU3RhdGVzLlZHX1BMQVlJTkc7XG5cbiAgICBpZiAodGhpcy52Z01hc3Rlcikge1xuICAgICAgaWYgKCF0aGlzLnN5bmNTdWJzY3JpcHRpb24gfHwgdGhpcy5zeW5jU3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgICB0aGlzLnN0YXJ0U3luYygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3RhcnRCdWZmZXJDaGVjaygpO1xuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uUGF1c2UoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuc3RhdGUgPSBWZ1N0YXRlcy5WR19QQVVTRUQ7XG5cbiAgICBpZiAodGhpcy52Z01hc3Rlcikge1xuICAgICAgaWYgKCF0aGlzLnBsYXlBdGZlclN5bmMpIHtcbiAgICAgICAgdGhpcy5zeW5jU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zdG9wQnVmZmVyQ2hlY2soKTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvblRpbWVVcGRhdGUoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGVuZCA9IHRoaXMuYnVmZmVyZWQubGVuZ3RoIC0gMTtcblxuICAgIHRoaXMudGltZSA9IHtcbiAgICAgIGN1cnJlbnQ6IHRoaXMuY3VycmVudFRpbWUgKiAxMDAwLFxuICAgICAgdG90YWw6IHRoaXMudGltZS50b3RhbCxcbiAgICAgIGxlZnQ6ICh0aGlzLmR1cmF0aW9uIC0gdGhpcy5jdXJyZW50VGltZSkgKiAxMDAwLFxuICAgIH07XG5cbiAgICBpZiAoZW5kID49IDApIHtcbiAgICAgIHRoaXMuYnVmZmVyID0geyBlbmQ6IHRoaXMuYnVmZmVyZWQuZW5kKGVuZCkgKiAxMDAwIH07XG4gICAgfVxuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uUHJvZ3Jlc3MoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGVuZCA9IHRoaXMuYnVmZmVyZWQubGVuZ3RoIC0gMTtcblxuICAgIGlmIChlbmQgPj0gMCkge1xuICAgICAgdGhpcy5idWZmZXIgPSB7IGVuZDogdGhpcy5idWZmZXJlZC5lbmQoZW5kKSAqIDEwMDAgfTtcbiAgICB9XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25Wb2x1bWVDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIC8vIFRPRE86IFNhdmUgdG8gbG9jYWxzdG9yYWdlIHRoZSBjdXJyZW50IHZvbHVtZVxuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uRXJyb3IoZXZlbnQ6IGFueSkge1xuICAgIC8vIFRPRE86IEhhbmRsZSBlcnJvciBtZXNzYWdlc1xuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzIzODI4MjQxLzc3OTUyOVxuICBidWZmZXJDaGVjaygpIHtcbiAgICBjb25zdCBvZmZzZXQgPSAxIC8gdGhpcy5jaGVja0ludGVydmFsO1xuICAgIHRoaXMuY3VycmVudFBsYXlQb3MgPSB0aGlzLmN1cnJlbnRUaW1lO1xuXG4gICAgaWYgKFxuICAgICAgIXRoaXMuaXNCdWZmZXJEZXRlY3RlZCAmJlxuICAgICAgdGhpcy5jdXJyZW50UGxheVBvcyA8IHRoaXMubGFzdFBsYXlQb3MgKyBvZmZzZXRcbiAgICApIHtcbiAgICAgIHRoaXMuaXNCdWZmZXJEZXRlY3RlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgdGhpcy5pc0J1ZmZlckRldGVjdGVkICYmXG4gICAgICB0aGlzLmN1cnJlbnRQbGF5UG9zID4gdGhpcy5sYXN0UGxheVBvcyArIG9mZnNldFxuICAgICkge1xuICAgICAgdGhpcy5pc0J1ZmZlckRldGVjdGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUHJldmVudCBjYWxscyB0byBidWZmZXJDaGVjayBhZnRlciBuZ09uRGVzdHJveSBoYXZlIGJlZW4gY2FsbGVkXG4gICAgaWYgKCF0aGlzLmJ1ZmZlckRldGVjdGVkLmNsb3NlZCkge1xuICAgICAgdGhpcy5idWZmZXJEZXRlY3RlZC5uZXh0KHRoaXMuaXNCdWZmZXJEZXRlY3RlZCk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0UGxheVBvcyA9IHRoaXMuY3VycmVudFBsYXlQb3M7XG4gIH1cblxuICBzdGFydEJ1ZmZlckNoZWNrKCkge1xuICAgIHRoaXMuY2hlY2tCdWZmZXJTdWJzY3JpcHRpb24gPSB0aW1lcigwLCB0aGlzLmNoZWNrSW50ZXJ2YWwpLnN1YnNjcmliZShcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5idWZmZXJDaGVjaygpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBzdG9wQnVmZmVyQ2hlY2soKSB7XG4gICAgaWYgKHRoaXMuY2hlY2tCdWZmZXJTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuY2hlY2tCdWZmZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQubmV4dCh0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQpO1xuICB9XG5cbiAgc2Vla1RpbWUodmFsdWU6IG51bWJlciwgYnlQZXJjZW50OiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBsZXQgc2Vjb25kOiBudW1iZXI7XG4gICAgY29uc3QgZHVyYXRpb246IG51bWJlciA9IHRoaXMuZHVyYXRpb247XG5cbiAgICBpZiAoYnlQZXJjZW50KSB7XG4gICAgICBzZWNvbmQgPSAodmFsdWUgKiBkdXJhdGlvbikgLyAxMDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlY29uZCA9IHZhbHVlO1xuICAgIH1cblxuICAgIHRoaXMuY3VycmVudFRpbWUgPSBzZWNvbmQ7XG4gIH1cblxuICBhZGRUZXh0VHJhY2soXG4gICAgdHlwZTogc3RyaW5nLFxuICAgIGxhYmVsPzogc3RyaW5nLFxuICAgIGxhbmd1YWdlPzogc3RyaW5nLFxuICAgIG1vZGU/OiAnZGlzYWJsZWQnIHwgJ2hpZGRlbicgfCAnc2hvd2luZydcbiAgKTogVGV4dFRyYWNrIHtcbiAgICBjb25zdCBuZXdUcmFjazogVGV4dFRyYWNrID0gdGhpcy52Z01lZGlhLmFkZFRleHRUcmFjayhcbiAgICAgIHR5cGUsXG4gICAgICBsYWJlbCxcbiAgICAgIGxhbmd1YWdlXG4gICAgKTtcblxuICAgIGlmIChtb2RlKSB7XG4gICAgICBuZXdUcmFjay5tb2RlID0gbW9kZTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld1RyYWNrO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy52Z01lZGlhLnNyYyA9ICcnO1xuICAgIHRoaXMubXV0YXRpb25PYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5jYW5QbGF5T2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuY2FuUGxheVRocm91Z2hPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5sb2FkZWRNZXRhZGF0YU9icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLndhaXRpbmdPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5wcm9ncmVzc09icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmVuZGVkT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMucGxheWluZ09icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnBsYXlPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5wYXVzZU9icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnRpbWVVcGRhdGVPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy52b2x1bWVDaGFuZ2VPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5lcnJvck9icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmNoZWNrQnVmZmVyU3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuc3luY1N1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcblxuICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQ/LmNvbXBsZXRlKCk7XG4gICAgdGhpcy5idWZmZXJEZXRlY3RlZD8udW5zdWJzY3JpYmUoKTtcblxuICAgIHRoaXMuYXBpLnVucmVnaXN0ZXJNZWRpYSh0aGlzKTtcbiAgfVxufVxuIl19